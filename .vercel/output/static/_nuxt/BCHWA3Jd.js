import{J as v,r as n,I as U,f as x,ac as L}from"./8_-c8HVq.js";const M=""+new URL("logo_main.Dt0GQpE3.png",import.meta.url).href,Y=()=>({setItem:(o,s)=>{try{localStorage.setItem(o,s)}catch(l){console.error("Error setting localStorage item:",l)}},getItem:o=>{try{return localStorage.getItem(o)}catch(s){return console.error("Error getting localStorage item:",s),null}},removeItem:o=>{try{localStorage.removeItem(o)}catch(s){console.error("Error removing localStorage item:",s)}}}),b={$_create_order(e){return v.post("/orders",e)},$_fetch_all_orders(){return v.get("/orders")},$_fetch_my_orders(e){return v.get("/orders/my-orders",{params:e})},$_get_order_statistics(){return v.get("/orders/statistics")},$_get_recent_orders(e){return v.get("/orders/recent",{params:e?{limit:e}:{}})},$_find_by_order_number(e){return v.get(`/orders/number/${e}`)},$_find_order_by_id(e){return v.get(`/orders/${e}`)},$_update_order_status(e,r){return v.patch(`/orders/${e}/status`,r)}},G=()=>{const e=n(!1),r=n(null);return{loading:e,error:r,updateOrderStatus:async(o,s)=>{var l,c;e.value=!0,r.value=null;try{return await b.$_update_order_status(o,s),!0}catch(m){throw r.value=((c=(l=m.response)==null?void 0:l.data)==null?void 0:c.message)||"Failed to update order status",r.value}finally{e.value=!1}}}},z={$_verify_payment(e){return v.post("/payments/verify",e)}},j=()=>{const e=n(!1),r=n(null);return{loading:e,error:r,verifyPayment:async o=>{var s,l;e.value=!0,r.value=null;try{return await z.$_verify_payment(o),!0}catch(c){throw r.value=((l=(s=c.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to verify payment",r.value}finally{e.value=!1}}}},H={$_create_transaction(e){return v.post("/transactions",e)}},K=()=>{const e=n(!1),r=n(null),f=n({});return{loading:e,apiRes:f,error:r,createTransaction:async s=>{var l,c;e.value=!0,r.value=null;try{const m=await H.$_create_transaction(s);return f.value=m,m}catch(m){throw r.value=((c=(l=m.response)==null?void 0:l.data)==null?void 0:c.message)||"Failed to create transaction",r.value}finally{e.value=!1}}}},W=()=>{const e=U(),{updateOrderStatus:r}=G(),{createTransaction:f,apiRes:o}=K(),{verifyPayment:s}=j(),{removeItem:l}=Y(),c={CART:"art-gallery-cart",CHECKOUT_STEP:"checkout-step",DELIVERY_DETAILS:"checkout-delivery-details",DELIVERY_METHOD:"checkout-delivery-method",PAYMENT_METHOD:"checkout-payment-method",PAYMENT_TYPE:"checkout-payment-type",INSTALLMENT_CONFIG:"checkout-installment-config",SELECTED_COUNTRY:"checkout-selected-country",SHIPPING_CONFIG:"checkout-shipping-config",TAX_CONFIG:"checkout-tax-config",GUEST_MODE:"checkout-guest-mode"},m=n([]),O=()=>{try{localStorage&&Object.values(c).forEach(t=>{t!==c.CART&&l(t)})}catch(t){console.error("Failed to clear persisted checkout data:",t)}},u=n({firstname:"",lastname:"",email:"",phone:""}),y=n({amount:"",orderRef:"",customerEmail:"",customerName:"",customerPhone:""}),p=n(!1),N=n(null),S=n(null),i=n({}),$=x(()=>`${u.value.firstname} ${u.value.lastname}`),P=()=>`usd-tx-${Date.now()}-${Math.floor(Math.random()*1e6)}`,R=t=>{t&&(u.value.firstname=t.firstName||u.value.firstname,u.value.lastname=t.lastName||u.value.lastname,u.value.email=t.email||u.value.email,u.value.phone=t.phone||u.value.phone)},k=()=>{var d;if(!S.value){console.warn("Payment data not set before initializing Flutterwave.");return}const t=S.value;N.value=L.useFlutterwave({amount:Number(t.amount),callback:async a=>{var E,g,w,I,_;if(console.log(a.flw_ref,"Payment callback received"),console.log(i.value,"incoming order details accessed from callback"),console.log(a,"flutterwave data"),a.status==="successful")try{p.value=!0;const h={user:i.value.customer,type:"payment",amount:a.amount||t.amount,status:"successful",order:((E=i==null?void 0:i.value)==null?void 0:E.id)||((g=i==null?void 0:i.value)==null?void 0:g._id),paymentMethod:"flutterwave",paymentReference:a.flw_ref,currency:"USD",description:`Payment for order #${((w=i==null?void 0:i.value)==null?void 0:w.orderNumber)||a.flw_ref}`},A=await f(h);if(console.log(A,"response from transaction creation"),localStorage&&(localStorage.removeItem(c.CART),m.value=[]),O(),(_=(I=o==null?void 0:o.value)==null?void 0:I.data)!=null&&_.transactionId){const C={transactionId:o.value.data.transactionId,reference:o.value.data.paymentReference};await s(C)}const F={status:"processing",notes:"",trackingNumber:"",trackingUrl:"",estimatedDelivery:""},T=i.value.id||i.value._id;T?(await r(T,F),p.value=!1,await e.push(`/order-success?tranxId=${a.flw_ref}&amount=${a.amount||t.amount}`)):(console.error("Order ID is missing"),p.value=!1)}catch(h){console.error("Error processing successful payment:",h),p.value=!1}else p.value=!1,console.error("Payment was not successful:",a.status)},currency:"USD",country:"US",customer:{email:t.customerEmail,name:t.customerName,phone_number:t.customerPhone},customizations:{description:"Order Payment",logo:M,title:"Raymond Aworo Art"},meta:{transaction_type:"international",order_ref:((d=t.orderDetails)==null?void 0:d.orderRef)||y.value.orderRef||"none"},onclose(){p.value=!1,console.log("Payment modal closed")},payment_options:"card,ussd,banktransfer",public_key:"FLWPUBK_TEST-6875ac7778fc80a80794f85b9a6df8d8-X",redirect_url:void 0,tx_ref:t.tx_ref})};return{handlePayment:async(t=null)=>{console.log(t,"incoming order details"),i.value=t;try{if(p.value=!0,!t)throw new Error("Order details are required for payment");const d=t.shippingAddress||{},a=t.billingAddress||{},E=`${d.firstName||a.firstName||""} ${d.lastName||a.lastName||""}`.trim()||$.value,g=d.email||a.email||u.value.email,w=d.phone||a.phone||u.value.phone,I=t.orderNumber?`${t.orderNumber}`:P(),_=t.paidAmount;if(!g)throw new Error("Customer email is required");if(!_||_<=0)throw new Error("Valid payment amount is required");const h={amount:Number(_),customerEmail:g,customerName:E,customerPhone:w,tx_ref:I,orderDetails:t};if(S.value=h,k(),console.log("initializing,,,,,"),N.value)N.value.init();else throw new Error("Failed to initialize Flutterwave")}catch(d){console.error("Error initiating payment:",d),p.value=!1}},paymentForm:y,loading:p,generateTxRef:P,setOrderDetails:(t,d,a=null)=>{y.value.orderRef=t,y.value.amount=d,a&&(y.value.customerEmail=a.email||u.value.email,y.value.customerName=`${a.firstName||""} ${a.lastName||""}`.trim()||$.value,y.value.customerPhone=a.phone||u.value.phone)},updateUserData:R}},X=()=>{const e=n(!1),r=n(null),f=n({});return{loading:e,apiRes:f,error:r,createOrder:async s=>{var l,c;e.value=!0,r.value=null;try{const m=await b.$_create_order(s);return f.value=m,m}catch(m){throw r.value=((c=(l=m.response)==null?void 0:l.data)==null?void 0:c.message)||"Failed to create order",r.value}finally{e.value=!1}}}};export{W as a,Y as b,G as c,X as u};
